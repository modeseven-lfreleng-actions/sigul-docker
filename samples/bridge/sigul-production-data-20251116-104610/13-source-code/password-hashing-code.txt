=== Password Hashing Logic ===
/usr/share/sigul/client.py-    def send_inner(self, inner_fields, omit_payload_auth=False):
/usr/share/sigul/client.py-        '''Send the inner header, including inner_fields.'''
/usr/share/sigul/client.py-        # FIXME: handle errors.UNKNOWN_VERSION - there is no inner session and
/usr/share/sigul/client.py-        # outer session data is not all read
/usr/share/sigul/client.py-        fields = dict(inner_fields) # Shallow copy
/usr/share/sigul/client.py:        fields['header-auth-sha512'] = self.__request_header_writer.sha512()
/usr/share/sigul/client.py-        if not omit_payload_auth:
/usr/share/sigul/client.py:            fields['payload-auth-sha512'] = \
/usr/share/sigul/client.py:                self.__request_payload_writer.sha512()
/usr/share/sigul/client.py-
/usr/share/sigul/client.py-        mech = nss.nss.CKM_SHA512_HMAC
/usr/share/sigul/client.py-        slot = nss.nss.get_best_slot(mech)
/usr/share/sigul/client.py-        nss_key = slot.key_gen(mech, None, 64)
/usr/share/sigul/client.py-        fields['header-auth-key'] = nss_key.key_data
/usr/share/sigul/client.py-        self.__reply_header_reader = \
/usr/share/sigul/client.py-            utils.SHA512HMACReader(self.__client.outer_read, nss_key)
/usr/share/sigul/client.py-        nss_key = slot.key_gen(mech, None, 64)
/usr/share/sigul/client.py-        fields['payload-auth-key'] = nss_key.key_data
/usr/share/sigul/client.py-        self.__reply_payload_reader = \
/usr/share/sigul/client.py-            utils.SHA512HMACReader(self.__client.outer_read, nss_key)
/usr/share/sigul/client.py-
/usr/share/sigul/client.py-        try:
/usr/share/sigul/client.py-            self.__client.inner_open_client(self.config.server_hostname,
/usr/share/sigul/client.py-                                            self.config.client_cert_nickname)
/usr/share/sigul/client.py-        except double_tls.InnerCertificateNotFound, e:
/usr/share/sigul/client.py-            raise ClientError(str(e))
/usr/share/sigul/client.py-        try:
/usr/share/sigul/client.py-            self.__client.inner_write(utils.format_fields(fields))
/usr/share/sigul/client.py-        finally:
--
/usr/share/sigul/utils.py-
/usr/share/sigul/utils.py-    def __init__(self, read_fn):
/usr/share/sigul/utils.py-        self.__digest = nss.nss.create_digest_context(nss.nss.SEC_OID_SHA512)
/usr/share/sigul/utils.py-        super(SHA512Reader, self).__init__(read_fn, self.__digest)
/usr/share/sigul/utils.py-
/usr/share/sigul/utils.py:    def sha512(self):
/usr/share/sigul/utils.py-        '''Return a SHA-512 hash of the data sent so far.'''
/usr/share/sigul/utils.py-        digest = self.__digest.digest_final()
/usr/share/sigul/utils.py-        self.__digest = None # Just to be sure nothing unexpected happens
/usr/share/sigul/utils.py-        return digest
/usr/share/sigul/utils.py-
/usr/share/sigul/utils.py-class SHA512HMACReader(_DigestsReader):
/usr/share/sigul/utils.py-    '''A wrapper with a .read method, computing a SHA-512 HMAC of the data.'''
/usr/share/sigul/utils.py-
/usr/share/sigul/utils.py-    def __init__(self, read_fn, nss_key):
/usr/share/sigul/utils.py-        self.__hmac = nss.nss.create_context_by_sym_key \
/usr/share/sigul/utils.py-            (nss.nss.CKM_SHA512_HMAC, nss.nss.CKA_SIGN, nss_key, None)
/usr/share/sigul/utils.py-        super(SHA512HMACReader, self).__init__(read_fn, self.__hmac)
/usr/share/sigul/utils.py-
/usr/share/sigul/utils.py-    def verify_64B_hmac_authenticator(self):
/usr/share/sigul/utils.py-        '''Compute and read HMAC of the data sent so far.
/usr/share/sigul/utils.py-
/usr/share/sigul/utils.py-        Return True if the computed HMAC matches the input value.
/usr/share/sigul/utils.py-
/usr/share/sigul/utils.py-        '''
/usr/share/sigul/utils.py-        digest = self.__hmac.digest_final()
--
/usr/share/sigul/utils.py-        auth = self.__hmac.digest_final()
/usr/share/sigul/utils.py-        self.__hmac = None # Just to be sure nothing unexpected happens
/usr/share/sigul/utils.py-        assert len(auth) == 64
/usr/share/sigul/utils.py-        return auth
/usr/share/sigul/utils.py-
/usr/share/sigul/utils.py:    def sha512(self):
/usr/share/sigul/utils.py-        '''Return a SHA-512 hash of the data sent so far.'''
/usr/share/sigul/utils.py-        digest = self.__digest.digest_final()
/usr/share/sigul/utils.py-        self.__digest = None # Just to be sure nothing unexpected happens
/usr/share/sigul/utils.py-        return digest
/usr/share/sigul/utils.py-
/usr/share/sigul/utils.py-class _DigestsWriter(object):
/usr/share/sigul/utils.py-    '''A wrapper with a .write method, computing digests of the data.'''
/usr/share/sigul/utils.py-
/usr/share/sigul/utils.py-    def __init__(self, write_fn, *digests):
/usr/share/sigul/utils.py-        self._write_fn = write_fn
/usr/share/sigul/utils.py-        self.__digests = digests
/usr/share/sigul/utils.py-        for d in self.__digests:
/usr/share/sigul/utils.py-            d.digest_begin()
/usr/share/sigul/utils.py-
/usr/share/sigul/utils.py-    def write(self, data):
/usr/share/sigul/utils.py-        '''Write data, adding it to digests as well.'''
/usr/share/sigul/utils.py-        self._write_fn(data)
/usr/share/sigul/utils.py-        for d in self.__digests:
/usr/share/sigul/utils.py-            d.digest_op(data)
/usr/share/sigul/utils.py-
--
/usr/share/sigul/utils.py-
/usr/share/sigul/utils.py-    def __init__(self, write_fn):
/usr/share/sigul/utils.py-        self.__digest = nss.nss.create_digest_context(nss.nss.SEC_OID_SHA512)
/usr/share/sigul/utils.py-        super(SHA512Writer, self).__init__(write_fn, self.__digest)
/usr/share/sigul/utils.py-
/usr/share/sigul/utils.py:    def sha512(self):
/usr/share/sigul/utils.py-        '''Return a SHA-512 hash of the data sent so far.'''
/usr/share/sigul/utils.py-        digest = self.__digest.digest_final()
/usr/share/sigul/utils.py-        self.__digest = None # Just to be sure nothing unexpected happens
/usr/share/sigul/utils.py-        return digest
/usr/share/sigul/utils.py-
/usr/share/sigul/utils.py-class SHA512HMACWriter(_DigestsWriter):
/usr/share/sigul/utils.py-    '''A wrapper with a .write method, computing a SHA-512 HMAC of the data.'''
/usr/share/sigul/utils.py-
/usr/share/sigul/utils.py-    def __init__(self, write_fn, nss_key):
/usr/share/sigul/utils.py-        self.__hmac = nss.nss.create_context_by_sym_key \
/usr/share/sigul/utils.py-            (nss.nss.CKM_SHA512_HMAC, nss.nss.CKA_SIGN, nss_key, None)
/usr/share/sigul/utils.py-        super(SHA512HMACWriter, self).__init__(write_fn, self.__hmac)
/usr/share/sigul/utils.py-
/usr/share/sigul/utils.py-    def write_64B_hmac(self):
/usr/share/sigul/utils.py-        '''Compute and write HMAC of the data sent so far.'''
/usr/share/sigul/utils.py-        auth = self.__hmac.digest_final()
/usr/share/sigul/utils.py-        self.__hmac = None # Just to be sure nothing unexpected happens
/usr/share/sigul/utils.py-        assert len(auth) == 64
/usr/share/sigul/utils.py-        self._write_fn(auth)
/usr/share/sigul/utils.py-
